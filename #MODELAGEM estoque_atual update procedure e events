#MODELAGEM TABELA ATUALIZA√á√ÉO ESTOQUE ATUAL ESTOQUE_ALMOX
DELIMITER $$

CREATE PROCEDURE atualiza_estoque_automatico()
BEGIN
  /*
    Atualiza a tabela estoque_atual, fazendo a correspond√™ncia pelo c√≥digo do produto.
    A quantidade em estoque_atual passa a ser igual ao ESTOQUE_MAXIMO da tabela produto.
  */
  UPDATE estoque_atual ea
  JOIN produto p ON ea.codigo = p.CODIGO_PRODUTO
  SET ea.quantidade = p.ESTOQUE_MAXIMO;
END$$

DELIMITER ;
##########################################################


DELIMITER $$

CREATE TRIGGER trg_produto_after_update
AFTER UPDATE ON produto
FOR EACH ROW
BEGIN
  CALL atualiza_estoque_automatico();
END$$

DELIMITER ;

########COMENTARIOS####################

C√ìDIGO CORRETO DO TRIGGER

Use este c√≥digo SQL para substituir o trigger atual atualiza_estoque_maximo:

DELIMITER $$

CREATE TRIGGER atualiza_estoque_maximo
AFTER UPDATE ON estoque_atual
FOR EACH ROW
BEGIN
  -- Atualiza o produto correspondente
  UPDATE produto p
  SET p.ESTOQUE_MAXIMO = NEW.quantidade
  WHERE p.CODIGO_PRODUTO = NEW.codigo;
END$$

DELIMITER ;

üí° Explica√ß√£o

AFTER UPDATE ON estoque_atual ‚Üí o gatilho executa depois que a linha de estoque_atual foi atualizada.

FOR EACH ROW ‚Üí roda para cada linha alterada.

NEW.quantidade ‚Üí √© o novo valor do campo quantidade ap√≥s o UPDATE.

WHERE p.CODIGO_PRODUTO = NEW.codigo ‚Üí garante que s√≥ o produto com o mesmo c√≥digo seja atualizado.

üßπ Antes de criar, remova o antigo trigger (se existir)

Execute primeiro:

DROP TRIGGER IF EXISTS atualiza_estoque_maximo;


Depois crie o novo trigger com o c√≥digo acima.

‚öôÔ∏è Teste pr√°tico
UPDATE estoque_atual
SET quantidade = 500
WHERE codigo = '#EA90013';


Ap√≥s isso, rode:

SELECT CODIGO_PRODUTO, ESTOQUE_MAXIMO FROM produto WHERE CODIGO_PRODUTO = '#EA90013';


üëâ O campo ESTOQUE_MAXIMO deve estar agora com valor 500.
################################################################

EXEMPLO ##########################

comando SQL completo para atualizar somente o campo ESTOQUE_MAXIMO na tabela produto, de acordo com os c√≥digos e quantidades que voc√™ forneceu:

UPDATE produto SET ESTOQUE_MAXIMO = 30 WHERE CODIGO_PRODUTO = '#EA90013';
UPDATE produto SET ESTOQUE_MAXIMO = 10 WHERE CODIGO_PRODUTO = '#CH109728';
UPDATE produto SET ESTOQUE_MAXIMO = 15 WHERE CODIGO_PRODUTO = '#CH109652';
UPDATE produto SET ESTOQUE_MAXIMO = 100 WHERE CODIGO_PRODUTO = '#CH90070';
UPDATE produto SET ESTOQUE_MAXIMO = 20 WHERE CODIGO_PRODUTO = '#EA90222';
UPDATE produto SET ESTOQUE_MAXIMO = 50 WHERE CODIGO_PRODUTO = '#EA90254';
UPDATE produto SET ESTOQUE_MAXIMO = 300 WHERE CODIGO_PRODUTO = '#EA20837';
UPDATE produto SET ESTOQUE_MAXIMO = 360 WHERE CODIGO_PRODUTO = '#EA20005';
UPDATE produto SET ESTOQUE_MAXIMO = 280 WHERE CODIGO_PRODUTO = '#EA90091';
UPDATE produto SET ESTOQUE_MAXIMO = 200 WHERE CODIGO_PRODUTO = '#EA20838';
UPDATE produto SET ESTOQUE_MAXIMO = 399 WHERE CODIGO_PRODUTO = '#EA20839';
UPDATE produto SET ESTOQUE_MAXIMO = 87 WHERE CODIGO_PRODUTO = '#CH90056';
UPDATE produto SET ESTOQUE_MAXIMO = 833 WHERE CODIGO_PRODUTO = '#CH90067';
UPDATE produto SET ESTOQUE_MAXIMO = 450 WHERE CODIGO_PRODUTO = '#EA20840';
UPDATE produto SET ESTOQUE_MAXIMO = 39 WHERE CODIGO_PRODUTO = '#EA90014';
UPDATE produto SET ESTOQUE_MAXIMO = 100 WHERE CODIGO_PRODUTO = '#EA90305';
UPDATE produto SET ESTOQUE_MAXIMO = 545 WHERE CODIGO_PRODUTO = '#EA20836';


üí° Dica:
Se quiser executar tudo de uma vez com mais efici√™ncia (um √∫nico comando SQL), pode usar o CASE assim:

UPDATE produto
SET ESTOQUE_MAXIMO = CASE CODIGO_PRODUTO
  WHEN '#EA90013' THEN 30
  WHEN '#CH109728' THEN 10
  WHEN '#CH109652' THEN 15
  WHEN '#CH90070' THEN 100
  WHEN '#EA90222' THEN 20
  WHEN '#EA90254' THEN 50
  WHEN '#EA20837' THEN 300
  WHEN '#EA20005' THEN 360
  WHEN '#EA90091' THEN 280
  WHEN '#EA20838' THEN 200
  WHEN '#EA20839' THEN 399
  WHEN '#CH90056' THEN 87
  WHEN '#CH90067' THEN 833
  WHEN '#EA20840' THEN 450
  WHEN '#EA90014' THEN 39
  WHEN '#EA90305' THEN 100
  WHEN '#EA20836' THEN 545
END
WHERE CODIGO_PRODUTO IN (
  '#EA90013', '#CH109728', '#CH109652', '#CH90070',
  '#EA90222', '#EA90254', '#EA20837', '#EA20005',
  '#EA90091', '#EA20838', '#EA20839', '#CH90056',
  '#CH90067', '#EA20840', '#EA90014', '#EA90305', '#EA20836'
);
#########################EXEMPLOS################################

queue (CODIGO_PRODUTO, ESTOQUE_ATUAL), aqui est√° o comando SQL completo e seguro para atualizar o campo ESTOQUE_MAXIMO da tabela produto com base nos valores dessa queue.

üîπ Atualiza√ß√£o direta via JOIN
UPDATE produto p
JOIN queue q ON p.CODIGO_PRODUTO = q.CODIGO_PRODUTO
SET p.ESTOQUE_MAXIMO = q.ESTOQUE_ATUAL;

üîπ Verificar se atualizou corretamente

Depois de executar o UPDATE, rode este SELECT para confirmar os valores:

SELECT 
  p.id_PRODUTO,
  p.CODIGO_PRODUTO,
  p.NOME,
  p.ESTOQUE_MAXIMO AS novo_estoque_maximo,
  q.ESTOQUE_ATUAL AS estoque_da_queue
FROM produto p
JOIN queue q ON p.CODIGO_PRODUTO = q.CODIGO_PRODUTO
ORDER BY p.CODIGO_PRODUTO;

üîπ (Opcional) Automatizar a cada minuto

Se quiser que isso rode automaticamente a cada 1 minuto, voc√™ pode criar um EVENT no MySQL:

SET GLOBAL event_scheduler = ON;

CREATE EVENT atualiza_estoque_maximo
ON SCHEDULE EVERY 1 MINUTE
DO
  UPDATE produto p
  JOIN queue q ON p.CODIGO_PRODUTO = q.CODIGO_PRODUTO
  SET p.ESTOQUE_MAXIMO = q.ESTOQUE_ATUAL;


Esse evento vai sincronizar ESTOQUE_MAXIMO com ESTOQUE_ATUAL da tabela queue automaticamente, sem precisar executar o comando manualmente.

üí° Resumo do que o comando faz:

Faz o match entre CODIGO_PRODUTO nas duas tabelas.

Atualiza produto.ESTOQUE_MAXIMO com o valor de queue.ESTOQUE_ATUAL.

Pode ser rodado manualmente ou automaticamente via EVENT.

