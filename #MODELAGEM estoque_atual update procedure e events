#MODELAGEM TABELA ATUALIZAÇÃO ESTOQUE ATUAL ESTOQUE_ALMOX
DELIMITER $$

CREATE PROCEDURE atualiza_estoque_automatico()
BEGIN
  /*
    Atualiza a tabela estoque_atual, fazendo a correspondência pelo código do produto.
    A quantidade em estoque_atual passa a ser igual ao ESTOQUE_MAXIMO da tabela produto.
  */
  UPDATE estoque_atual ea
  JOIN produto p ON ea.codigo = p.CODIGO_PRODUTO
  SET ea.quantidade = p.ESTOQUE_MAXIMO;
END$$

DELIMITER ;
##########################################################


DELIMITER $$

CREATE TRIGGER trg_produto_after_update
AFTER UPDATE ON produto
FOR EACH ROW
BEGIN
  CALL atualiza_estoque_automatico();
END$$

DELIMITER ;

