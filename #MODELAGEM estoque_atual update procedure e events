#MODELAGEM TABELA ATUALIZA√á√ÉO ESTOQUE ATUAL ESTOQUE_ALMOX
DELIMITER $$

CREATE PROCEDURE atualiza_estoque_automatico()
BEGIN
  /*
    Atualiza a tabela estoque_atual, fazendo a correspond√™ncia pelo c√≥digo do produto.
    A quantidade em estoque_atual passa a ser igual ao ESTOQUE_MAXIMO da tabela produto.
  */
  UPDATE estoque_atual ea
  JOIN produto p ON ea.codigo = p.CODIGO_PRODUTO
  SET ea.quantidade = p.ESTOQUE_MAXIMO;
END$$

DELIMITER ;
##########################################################


DELIMITER $$

CREATE TRIGGER trg_produto_after_update
AFTER UPDATE ON produto
FOR EACH ROW
BEGIN
  CALL atualiza_estoque_automatico();
END$$

DELIMITER ;

########COMENTARIOS####################

C√ìDIGO CORRETO DO TRIGGER

Use este c√≥digo SQL para substituir o trigger atual atualiza_estoque_maximo:

DELIMITER $$

CREATE TRIGGER atualiza_estoque_maximo
AFTER UPDATE ON estoque_atual
FOR EACH ROW
BEGIN
  -- Atualiza o produto correspondente
  UPDATE produto p
  SET p.ESTOQUE_MAXIMO = NEW.quantidade
  WHERE p.CODIGO_PRODUTO = NEW.codigo;
END$$

DELIMITER ;

üí° Explica√ß√£o

AFTER UPDATE ON estoque_atual ‚Üí o gatilho executa depois que a linha de estoque_atual foi atualizada.

FOR EACH ROW ‚Üí roda para cada linha alterada.

NEW.quantidade ‚Üí √© o novo valor do campo quantidade ap√≥s o UPDATE.

WHERE p.CODIGO_PRODUTO = NEW.codigo ‚Üí garante que s√≥ o produto com o mesmo c√≥digo seja atualizado.

üßπ Antes de criar, remova o antigo trigger (se existir)

Execute primeiro:

DROP TRIGGER IF EXISTS atualiza_estoque_maximo;


Depois crie o novo trigger com o c√≥digo acima.

‚öôÔ∏è Teste pr√°tico
UPDATE estoque_atual
SET quantidade = 500
WHERE codigo = '#EA90013';


Ap√≥s isso, rode:

SELECT CODIGO_PRODUTO, ESTOQUE_MAXIMO FROM produto WHERE CODIGO_PRODUTO = '#EA90013';


üëâ O campo ESTOQUE_MAXIMO deve estar agora com valor 500.
